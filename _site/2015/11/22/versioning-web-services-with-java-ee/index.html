<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Versioning web-services with Java EE</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,300i,600">
  <link rel="stylesheet" href="/style.css">
  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Eduardo Colabardini" href="/feed.xml" />
  <!-- Begin Jekyll SEO tag v1.4.0 -->
<title>Versioning web-services with Java EE - Eduardo Colabardini</title>
<meta property="og:title" content="Versioning web-services with Java EE" />
<meta name="description" content="So, how do you plan on versioning your web-services?" />
<meta property="og:description" content="So, how do you plan on versioning your web-services?" />
<link rel="canonical" href="//ecolabardini.github.io/2015/11/22/versioning-web-services-with-java-ee/" />
<meta property="og:url" content="//ecolabardini.github.io/2015/11/22/versioning-web-services-with-java-ee/" />
<meta property="og:site_name" content="Eduardo Colabardini" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-11-22T22:52:00-02:00" />
<link rel="next" href="//ecolabardini.github.io/2015/11/24/my-docker-whale-of-fortune/" title="My docker whale of fortune" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@ecolabardini" />
<meta name="twitter:creator" content="@Eduardo Colabardini" />
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Versioning web-services with Java EE",
    "datePublished": "2015-11-22T22:52:00-02:00",
    "description": "So, how do you plan on versioning your web-services?",
    "url": "//ecolabardini.github.io/2015/11/22/versioning-web-services-with-java-ee/"
  }
</script>
<!-- End Jekyll SEO tag -->
  
</head>
<body>
  <div class="container">
    <header class="masthead">
  <h1 class="masthead-title--small">
    <a href="/">Eduardo Colabardini</a>
  </h1>
</header>
<div class="content post">
  <h1 class="post-title">Versioning web-services with Java EE</h1>
  <div class="post-date">
    <time>22 Nov 2015</time>
  </div>
	<p class="post-meta" style="font-size:8">
		Tags:
		
		







<span style="white-space: nowrap; padding: 0.4em;">
	<a href="/tags/api" class="tag">api
		<span>(1)</span>
	</a>
</span>


<span style="white-space: nowrap; padding: 0.4em;">
	<a href="/tags/archetype" class="tag">archetype
		<span>(1)</span>
	</a>
</span>


<span style="white-space: nowrap; padding: 0.4em;">
	<a href="/tags/javaee" class="tag">javaee
		<span>(1)</span>
	</a>
</span>


<span style="white-space: nowrap; padding: 0.4em;">
	<a href="/tags/jaxrs" class="tag">jaxrs
		<span>(1)</span>
	</a>
</span>


<span style="white-space: nowrap; padding: 0.4em;">
	<a href="/tags/maven" class="tag">maven
		<span>(1)</span>
	</a>
</span>


<span style="white-space: nowrap; padding: 0.4em;">
	<a href="/tags/rest" class="tag">rest
		<span>(1)</span>
	</a>
</span>


<span style="white-space: nowrap; padding: 0.4em;">
	<a href="/tags/restful" class="tag">restful
		<span>(1)</span>
	</a>
</span>


<span style="white-space: nowrap; padding: 0.4em;">
	<a href="/tags/wildfly" class="tag">wildfly
		<span>(1)</span>
	</a>
</span>


		</p>
  <p>So, how do you plan on versioning your web-services?</p>

<p>This is crucial today, when you business logic is changing all the time and you have to add new fields, parameters, validations and so on. But how to do this without breaking products that already depend upon your API?</p>

<p>There are some simple ways to accomplish this:</p>

<ul>
  <li>Add the version on you URL path: <a href="http://www.example.com/api/v2/user">http://www.example.com/api/v2/user</a></li>
  <li>Add a custom request header: <code class="highlighter-rouge">api-version: 2</code></li>
  <li>Modify the accept header: <code class="highlighter-rouge">Accept: application/com.example.v2+json</code></li>
  <li>Add a query parameter: <a href="http://www.example.com/api/user?version=v2">http://www.example.com/api/user?version=v2</a></li>
</ul>

<p>In this tutorial I will cover the first method with Java EE, since it is more evident to customers and easy to implement because of the way JAX-RS handles paths (I think it might break the RESTful philosophy because the resource path changes…).</p>

<p>Let’s start with a Maven Archetype (I’m using Apache Maven 3.3.3). The command below generates a Java EE 7 webapp project for Wildfly. The project is an EAR, with an EJB-JAR and WAR.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mvn -B archetype:generate <span class="se">\</span>
-DgroupId<span class="o">=</span>com.github.ecolabardini <span class="se">\</span>
-DartifactId<span class="o">=</span>example <span class="se">\</span>
-Dversion<span class="o">=</span>0.1-SNAPSHOT  <span class="se">\</span>
-DarchetypeArtifactId<span class="o">=</span>wildfly-javaee7-webapp-ear-blank-archetype <span class="se">\</span>
-DarchetypeGroupId<span class="o">=</span>org.wildfly.archetype <span class="se">\</span>
-DarchetypeVersion<span class="o">=</span>8.2.0.Final <span class="se">\</span>
-DarchetypeRepository<span class="o">=</span>http://repository.jboss.org/nexus/content/groups/public
</code></pre>
</div>

<p>Download Wildfly 8.2.1 Final, extract and run it on standalone mode:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>wget http://download.jboss.org/wildfly/8.2.1.Final/wildfly-8.2.1.Final.tar.gz
tar xvfz wildfly-8.2.1.Final.tar.gz
./wildfly-8.2.1.Final/bin/standalone.sh
</code></pre>
</div>

<p>I created two Java classes (<code class="highlighter-rouge">rest.v1.UserRest</code> and <code class="highlighter-rouge">rest.v2.UserRest</code>) on the <code class="highlighter-rouge">example-web</code> project, they are exactly the same except for the package name. They are mapped on the <code class="highlighter-rouge">/user</code> REST path, and I added a GET method <code class="highlighter-rouge">/user/123</code> that prints <code class="highlighter-rouge">rest.v1: Hi, I'm user with ID 123</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">rest</span><span class="o">.</span><span class="na">v1</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.ws.rs.GET</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.Path</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.PathParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.Produces</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.core.MediaType</span><span class="o">;</span>

<span class="nd">@Path</span><span class="o">(</span><span class="s">"user"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserRest</span> <span class="o">{</span>
    <span class="nd">@GET</span>
    <span class="nd">@Path</span><span class="o">(</span><span class="s">"/{id}"</span><span class="o">)</span>
    <span class="nd">@Produces</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">TEXT_PLAIN</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">getUser</span><span class="o">(</span><span class="nd">@PathParam</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getPackage</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> 
        	<span class="s">": Hi, I'm user with ID "</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>We need to add the base path to these two implementations (<code class="highlighter-rouge">/api/v1/user/123</code> and <code class="highlighter-rouge">/api/v2/user/123</code>), so we implement the <code class="highlighter-rouge">javax.ws.rs.core.Application</code> defining the <code class="highlighter-rouge">@ApplicationPath</code>. So, again, I created two Java classes (<code class="highlighter-rouge">rest.v1.Application</code> and <code class="highlighter-rouge">rest.v2.Application</code>) on the <code class="highlighter-rouge">example-web</code> project, they are responsible for identifying which class works on each path, they are exactly the same except for the package name, <code class="highlighter-rouge">@ApplicationPath</code> and the UserRest import (<code class="highlighter-rouge">v1</code> or <code class="highlighter-rouge">v2</code>).</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">rest</span><span class="o">.</span><span class="na">v1</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.HashSet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.ws.rs.ApplicationPath</span><span class="o">;</span>

<span class="nd">@ApplicationPath</span><span class="o">(</span><span class="s">"/api/v1"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="kd">extends</span> <span class="n">javax</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">rs</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">Application</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">getClasses</span><span class="o">()</span> <span class="o">{</span>
	    <span class="kd">final</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">classes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;&gt;();</span>
	    <span class="n">classes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">UserRest</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
	    <span class="k">return</span> <span class="n">classes</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>To deploy the application, you can download the source code <a href="https://s3-us-west-2.amazonaws.com/ecolabardini/versioning-webservices.zip">here</a> and execute the following commands:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mvn clean install
cp example-ear/target/example-ear.ear wildfly-8.2.1.Final/standalone/deployments/
</code></pre>
</div>

<p>Then you can access:</p>

<ul>
  <li><a href="http://localhost:8080/example-web/api/v1/user/1">http://localhost:8080/example-web/api/v1/user/1</a></li>
  <li><a href="http://localhost:8080/example-web/api/v2/user/1">http://localhost:8080/example-web/api/v2/user/1</a></li>
</ul>

<p>As you can see, we have two running versions of the <code class="highlighter-rouge">UserRest</code>, and your client/customer is free to decide when it’s time to update his logic to the next version.</p>

<p>Note that on <code class="highlighter-rouge">rest.v2.Application</code> class you can still import classes from <code class="highlighter-rouge">rest.v1</code> package, exposing a new version of <code class="highlighter-rouge">UserRest</code> and maintaining an old version of other REST classes.</p>

<p>And if you are already providing a web-service to your customers, you can omit the first version <code class="highlighter-rouge">v1</code>, so everything continues working!</p>

<p><a href="https://s3-us-west-2.amazonaws.com/ecolabardini/versioning-webservices.zip">Download source code</a></p>

<h3 id="references">References</h3>
<ul>
  <li><a href="https://docs.oracle.com/javaee/7/tutorial/jaxrs002.htm" target="_blank">Creating a RESTful Root Resource Class, The Java EE Tutorial</a></li>
  <li><a href="http://www.troyhunt.com/2014/02/your-api-versioning-is-wrong-which-is.html" target="_blank">Your API versioning is wrong, Troy Hunt</a></li>
</ul>

</div>

<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
  this.page.identifier = window.location.href.replace('https://','http://');
};

(function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//ecolabardini.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                                    

  </div>
</body>
</html>
